{% extends 'admin/layout_admin.html' %}

{% block sidebar %}
  {% include 'admin/sidebar.html' %}
{% endblock %}

{% block content %}
  <div class="p-6">
    <div class="mb-6">
      <h1 class="text-3xl font-bold text-black">Monitoring Lamaran</h1>
      <p class="text-gray-700 mt-2">Daftar lamaran untuk program yang Anda kelola. Gunakan tombol pada kolom <span class="font-semibold">Aksi</span> untuk mengubah status.</p>
    </div>
    {% include 'partials/flash.html' %}

    <div class="max-w-full">

    {% if lamaran_list %}
      <div class="overflow-x-auto bg-white rounded-lg shadow ring-1 ring-black/5">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
              <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pelamar</th>
              <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Lowongan</th>
              <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Program</th>
              <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Applied At</th>
              <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
              <th scope="col" class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            {% for l in lamaran_list %}
              <tr>
                <td class="px-4 py-3 text-sm text-gray-700">{{ l.id }}</td>
                <td class="px-4 py-3 text-sm">
                  <div class="font-medium text-gray-800">{{ l.user_name }}</div>
                </td>
                <td class="px-4 py-3 text-sm text-gray-700">{{ l.judul_lowongan }}</td>
                <td class="px-4 py-3 text-sm text-gray-700">{{ l.nama_program }}</td>
                <td class="px-4 py-3 text-sm text-gray-500">{{ l.applied_at.strftime('%d %b %Y %H:%M') if l.applied_at else '-' }}</td>
                <td class="px-4 py-3 text-sm">
                  {% if l.status == 'menunggu' %}
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-yellow-100 text-yellow-800">Menunggu</span>
                  {% elif l.status == 'diterima' %}
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800">Diterima</span>
                  {% elif l.status == 'ditolak' %}
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-800">Ditolak</span>
                  {% else %}
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-gray-100 text-gray-800">{{ l.status }}</span>
                  {% endif %}
                </td>
                <td class="px-4 py-3 text-right text-sm">
                  <div class="inline-flex gap-2 items-center">
                    <form method="post" action="{{ url_for('lamaran_admin.update_status', lamaran_id=l.id) }}" onsubmit="return confirm('Terima lamaran ID {{ l.id }}?')">
                      <input type="hidden" name="status" value="diterima">
                      <button type="submit" class="px-3 py-1 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-md">Terima</button>
                    </form>

                    <form method="post" action="{{ url_for('lamaran_admin.update_status', lamaran_id=l.id) }}" onsubmit="return confirm('Tolak lamaran ID {{ l.id }}?')">
                      <input type="hidden" name="status" value="ditolak">
                      <button type="submit" class="px-3 py-1 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-md">Tolak</button>
                    </form>
                  </div>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="bg-white p-6 rounded-lg shadow">
        <p class="text-gray-600">Belum ada lamaran untuk program Anda.</p>
      </div>
    {% endif %}
    </div>
  </div>
{% endblock %}
