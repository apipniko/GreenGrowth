{% extends 'layout.html' %}
{% block title %}Edit Profil | GreenGrowth{% endblock %}

{% block article %}
<section class="w-full min-h-screen bg-[#F5F7FA]">

  <!-- ================= COVER ================= -->
  <div class="relative w-full">

    <!-- BACK BUTTON -->
    <a href="{{ url_for('profile_user.view_profile', user_id=profile.user_id) }}"
       class="group absolute bg-[#0BDAAA] rounded-full top-3 left-3 inline-flex items-center gap-3 text-sm font-semibold text-black z-20">
      <span
        class="w-9 h-9 flex items-center justify-center rounded-full border border-[#0BDAAA]
               group-hover:bg-[#0BDAAA] transition">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
             stroke-width="2" stroke="currentColor"
             class="w-4 h-4 group-hover:text-black">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
        </svg>
      </span>
    </a>

    <!-- COVER IMAGE -->
    <div
      class="w-full h-56 md:h-64 bg-cover bg-center"
      style="background-image:url('/static/images/loreg.jpg')">
    </div>

    <!-- AVATAR -->
    <div class="absolute left-10 bottom-0 translate-y-1/2 z-10">
      <div class="relative w-40 h-40">
        <img
          id="preview"
          src="{{ profile.foto_user or 'https://cdn-icons-png.flaticon.com/512/892/892781.png' }}"
          class="w-40 h-40 rounded-full border-4 border-white object-cover shadow-lg"
        >
        <label
          for="fotoInput"
          class="absolute bottom-2 right-2 bg-white p-2 rounded-full shadow cursor-pointer hover:bg-gray-100 transition">
          ✏️
        </label>
      </div>
    </div>

    <!-- FILE INPUT -->
    <input
      id="fotoInput"
      type="file"
      name="foto_user"
      accept="image/*"
      class="hidden"
      form="editProfileForm"
      onchange="previewImage(event)">
  </div>

  <!-- ================= CONTENT ================= -->
  <!-- padding-top dibuat lebih besar di mobile agar tidak tertutup avatar -->
  <div class="max-w-6xl mx-auto px-6 md:px-10 pt-32 md:pt-20 pb-20 md:ml-[11rem]">

    <!-- HEADER + SAVE BUTTON -->
    <div class="flex items-center mb-6 gap-8">

      <div class="flex-1 flex items-center justify-between">
        <h2 class="text-2xl font-semibold text-gray-700">
          Personal details
        </h2>

        <button
          type="submit"
          form="editProfileForm"
          class="inline-flex items-center gap-2 px-4 py-2 rounded-full
                 border bg-[#FFFFF] border-[#0BDAAA] text-[#0BDAAA]
                 hover:bg-[#0BDAAA] hover:text-white transition
                 focus:outline-none focus:ring-2 focus:ring-[#0BDAAA] focus:ring-offset-2">
          Save changes
        </button>
      </div>
    </div>

    <!-- FORM -->
    <form
      id="editProfileForm"
      method="POST"
      action="{{ url_for('profile_user.edit_profile', user_id=profile.user_id) }}"
      enctype="multipart/form-data"
      class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-white p-8 rounded-2xl shadow-2xl shadow-lg">

      {% set input = "w-full px-4 py-2.5 rounded-md border border-gray-300 focus:ring-2 focus:ring-[#0BDAAA] focus:outline-none bg-white" %}

      <div>
        <label class="text-sm text-gray-500">Nama Lengkap</label>
        <input name="nama_user" value="{{ profile.nama_user or '' }}" class="{{ input }}" required>
      </div>

      <div>
        <label class="text-sm text-gray-500">Email</label>
        <input name="email_user" value="{{ profile.email_user or '' }}" readonly class="{{ input }} bg-gray-100">
      </div>

      <div>
        <label class="text-sm text-gray-500">Jenis Kelamin</label>
        <select name="gender" class="{{ input }}">
          <option value="">Pilih</option>
          <option value="male" {% if profile.gender=='male' or profile.gender=='Laki-laki' %}selected{% endif %}>Laki-laki</option>
          <option value="female" {% if profile.gender=='female' or profile.gender=='Perempuan' %}selected{% endif %}>Perempuan</option>
        </select>
      </div>

      <div>
        <label class="text-sm text-gray-500">Tanggal Lahir</label>
        <input type="date" name="tanggal_lahir" value="{{ profile.tanggal_lahir or '' }}" class="{{ input }}">
      </div>

      <div>
        <label class="text-sm text-gray-500">Pendidikan Tertinggi</label>
        <select name="pendidikan_tertinggi" class="{{ input }}">
          <option value="">Pilih</option>
          <option value="Elementary School" {% if profile.pendidikan_tertinggi=='Elementary School' %}selected{% endif %}>Elementary School(SD)</option>
          <option value="Junior High School" {% if profile.pendidikan_tertinggi=='Junior High School' %}selected{% endif %}>Junior High School(SMP)</option>
          <option value="Senior High School" {% if profile.pendidikan_tertinggi=='Senior High School' %}selected{% endif %}>Senior High School(SMA/SMK?MAN)</option>
          <option value="Diploma 3" {% if profile.pendidikan_tertinggi=='Diploma 3' %}selected{% endif %}>Diploma 3</option>
          <option value="Diploma 4" {% if profile.pendidikan_tertinggi=='Diploma 4' %}selected{% endif %}>Diploma 4</option>
          <option value="Bachelors Degree" {% if profile.pendidikan_tertinggi=='Bachelors Degree' %}selected{% endif %}>S1</option>
          <option value="Master Degree" {% if profile.pendidikan_tertinggi=='Master Degree' %}selected{% endif %}>S2</option>
          <option value="Doctoral Degree" {% if profile.pendidikan_tertinggi=='Doctoral Degree' %}selected{% endif %}>S3</option>
        </select>
      </div>

      <div>
        <label class="text-sm text-gray-500">Softskill</label>
        <input name="softskill" value="{{ profile.softskill or '' }}" class="{{ input }}">
      </div>

      <div>
        <label class="text-sm text-gray-500">Hardskill</label>
        <input name="hardskill" value="{{ profile.hardskill or '' }}" class="{{ input }}">
      </div>

      <div>
        <label class="text-sm text-gray-500">Pengalaman</label>
        <input name="pengalaman" value="{{ profile.pengalaman or '' }}" class="{{ input }}">
      </div>

      <div>
        <label class="text-sm text-gray-500">No HP</label>
        <input name="no_hp" value="{{ profile.no_hp or '' }}" class="{{ input }}">
      </div>

      <div class="md:col-span-2">
        <label class="text-sm text-gray-500">Alamat</label>
        <textarea name="alamat" rows="3" class="{{ input }}">{{ profile.alamat or '' }}</textarea>
      </div>

    </form>
  </div>
</section>

<script>
function previewImage(event) {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = () => {
    document.getElementById('preview').src = reader.result;
  };
  reader.readAsDataURL(file);
}
</script>
{% endblock %}
