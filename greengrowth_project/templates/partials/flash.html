{% with messages = get_flashed_messages(with_categories=true) %} {% if messages %}
<script type="application/json" id="flash-messages-data">
  {{ messages | tojson }}
</script>
<script>
  (function () {
    const dataEl = document.getElementById("flash-messages-data");
    if (!dataEl) return;

    let toastMessages = [];
    try {
      const raw = JSON.parse(dataEl.textContent || "[]");
      toastMessages = Array.isArray(raw) ? raw.map((item) => ({ category: item[0], message: item[1] })) : [];
    } catch (err) {
      toastMessages = [];
    }

    function createToast(category, message) {
      const toastContainer = document.getElementById("toast-container") || createToastContainer();

      const bgColor = category === "success" ? "bg-green-500" : category === "error" || category === "danger" ? "bg-red-500" : "bg-blue-500";
      const icon = category === "success" ? "fa-check-circle" : category === "error" || category === "danger" ? "fa-exclamation-circle" : "fa-info-circle";

      const toast = document.createElement("div");
      toast.className = `fixed top-4 right-4 flex items-center gap-3 px-5 py-3 rounded-lg shadow-lg text-white ${bgColor} animate-slide-in z-50 pointer-events-auto`;
      toast.innerHTML = `
        <i class="fas ${icon}"></i>
        <span>${message}</span>
        <button onclick="this.parentElement.remove()" class="ml-2 hover:opacity-80">
          <i class="fas fa-times"></i>
        </button>
      `;

      toastContainer.appendChild(toast);

      setTimeout(() => {
        toast.classList.add("animate-fade-out");
        setTimeout(() => toast.remove(), 300);
      }, 4000);
    }

    function createToastContainer() {
      const container = document.createElement("div");
      container.id = "toast-container";
      container.className = "fixed top-0 right-0 z-50 pointer-events-none";
      document.body.appendChild(container);
      return container;
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", function () {
        toastMessages.forEach((msg) => createToast(msg.category, msg.message));
      });
    } else {
      toastMessages.forEach((msg) => createToast(msg.category, msg.message));
    }
  })();
</script>

<style>
  @keyframes slideIn {
    from {
      transform: translateX(400px);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }

  @keyframes fadeOut {
    from {
      transform: translateX(0);
      opacity: 1;
    }
    to {
      transform: translateX(400px);
      opacity: 0;
    }
  }

  .animate-slide-in {
    animation: slideIn 0.3s ease-out;
  }

  .animate-fade-out {
    animation: fadeOut 0.3s ease-out;
  }
</style>
{% endif %} {% endwith %}
